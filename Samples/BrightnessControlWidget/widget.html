<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Brightness Control</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            margin: 0;
        }
        .monitor {
            margin-bottom: 15px;
        }
        .monitor label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .slider {
            width: 100%;
            margin-bottom: 5px;
        }
        .brightness-value {
            font-size: 12px;
            color: #aaa;
        }
        .error {
            color: #ff6b6b;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="monitors"></div>
    
    <script>
        const API_BASE = 'http://localhost:7842';
        
        async function loadMonitors() {
            try {
                const response = await fetch(`${API_BASE}/monitors`);
                const monitors = await response.json();
                
                const container = document.getElementById('monitors');
                container.innerHTML = monitors.map(m => `
                    <div class="monitor">
                        <label>${m.name}</label>
                        <input type="range" 
                               class="slider" 
                               min="0" 
                               max="100" 
                               value="${m.brightness}"
                               oninput="setBrightness('${m.id}', this.value)">
                        <span class="brightness-value" id="value-${m.id}">${m.brightness}%</span>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('monitors').innerHTML = 
                    '<div class="error">⚠️ Backend not running. Please start Rusty Twinkle Tray.</div>';
            }
        }
        
        async function setBrightness(monitorId, value) {
            try {
                await fetch(`${API_BASE}/monitor/${monitorId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ brightness: parseInt(value) })
                });
                document.getElementById(`value-${monitorId}`).textContent = `${value}%`;
            } catch (error) {
                console.error('Failed to set brightness:', error);
            }
        }
        
        loadMonitors();
    </script>
</body>
</html>
